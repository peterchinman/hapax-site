<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>Hapax Legomena Finder</title>

   <meta name="description" content="Find Hapax Legomena from the safety of your browser.">
   <meta property="og:image" content="[[Insert Absolute Path]]">

   <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <header>
        <div class="inner-column">
            <div class="title">Hapax
Legomenon
Finder</div>
        </div>
    </header>
    <main>
        <div class="inner-column">
            <section class="explanation">
                <p>A <em>hapax legomenon</em> (abbreviated to <em>hapax</em>, pl. <em>hapax legomena</em>) is a word that's used only once in a body of text. In the translation of dead languages, hapaxes are the prickly outliersâ€”words that come with only a single context from which to infer their meaning.</p>
                <p>I'm interested in these the prickly points. The silhouette of a vocabulary.</p>
                <p><a href="https://peterchinman.substack.com/p/finding-hapaxes">Read about coding this project.</a></p>
            </section>
            <section class="explore-and-select">
                <section class="examples">
                    <h1 class="assertive">Explore hapaxes from these texts:</h1>
                    
                    <!-- TODO figure out how to get this links to work
                                probably onclick="load_moby_dick"
                                or: when it clicks do a php include -->
                    
                    <ul>
                        <li>
                            <a href="">Moby Dick</a>
                        </li>
                        <li>
                            <a href="">E. Dickinson</a>
                        </li>
                        <li>
                            <a href="">The Bible</a>
                        </li>
                        <li>
                            <a href="">Shakespeare</a>
                        </li>
                        <li>
                            <a href="">Proust</a>
                        </li>
                        <li>
                            <a href="">J. Joyce</a>
                        </li>
                        <li>
                            <a href="">Homer</a>
                        </li>
                        <li>
                            <a href="">Nietzsche</a>
                        </li>
                        <li>
                            <a href="">Milton</a>
                        </li>
                    </ul>
                </section>
                <section class="file-selection">
                    <h1 class="assertive">Or upload your own:</h1>
                    <div class="buttons">
                        <div class="select-text-input input">
                            <button id="select-text" onclick="fileInput.click()">Select Text</button>
                            <input class="button-label" type="file" id="fileInput">
                        </div>
                        <!-- <input type="number" value="1" id="depthInput" placeholder="Depth" /> -->
                        <div class="find-hapaxes-input input">
                            <button id="find-hapaxes" onclick="processFile()">Find Hapaxes</button>
                            <label class="button-label" for="find-hapaxes">Note: currently can only process plaintext files</label>
                        </div>
                    </div>
                </section>
            </section>
        </div>
    </main>

    <section class="hapax-output">
        <div class="inner-column">
            <h1 class="loud-voice">Found <span id="hapax-count"></span> hapaxes</h1>

            <!-- TODO figure out how to get this pre instead as a ul, each word as li -->
            <pre id="output"></pre>
        </div>
    </section>
    
    
    <script>
        // Initialize the WebAssembly module
        var Module = {
            onRuntimeInitialized: function() {
                console.log('WASM loaded');
            }
        };
    </script>

    <script src="hapax.js"></script>

    <script>
        function processFile() {
            const fileInput = document.getElementById('fileInput');
            // const depthInput = document.getElementById('depthInput');
            const output = document.getElementById('output');

            if (fileInput.files.length === 0) {
                output.textContent = 'Please select a file!';
                return;
            }


            const file = fileInput.files[0];
            // disabling depth for now, not actually needed
            // const depth = depthInput.value;
            const depth = 1;

            if (!depth) {
                output.textContent = 'Please enter a depth value!';
                return;
            }

            const reader = new FileReader();

            reader.onload = function(event) {
                const content = event.target.result;

                // Create a virtual filesystem in the browser
                FS.writeFile('input.txt', content);
                FS.open('output.txt', 'w+');

                // Run the WebAssembly module
                Module.callMain(['input.txt', 'output.txt', depth]);

                // Read the output file from the virtual filesystem
                const result = FS.readFile('output.txt', { encoding: 'utf8' });
                output.textContent = result;

                // TODO also set .hapax-output display: grid
                // TODO set focus on .hapax-output?
            };

            reader.readAsText(file);
        }
    </script>
</body>
</html>
